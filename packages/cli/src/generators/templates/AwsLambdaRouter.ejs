import { type AwsLambdaRoute, type AwsLambdaHandler, HttpMethod, AwsLambdaHttpRouter } from "<%= coreDir %>";
<% for(const route of routes) { %>
import type { I<%= route.pascalCaseOperationId %>Request } from "<%= route.requestFile %>";
import type { <%= route.pascalCaseOperationId %>SuccessResponses, I<%= route.pascalCaseOperationId %>Response } from "<%= route.responseFile %>";
import { <%= route.pascalCaseOperationId %>RequestValidator } from "<%= route.requestValidatorFile %>";
<% } %>

export type <%= pascalCaseEntityName %>AwsLambdaRouterHandler = {
<% for(const route of routes) { %>
    handle<%= route.pascalCaseOperationId %>Request: AwsLambdaHandler<I<%= route.pascalCaseOperationId %>Request, <%= route.pascalCaseOperationId %>SuccessResponses>;
<% } %>
};

type <%= pascalCaseEntityName %>Routes = readonly [
<% for(const route of routes) { %>
    AwsLambdaRoute<HttpMethod.<%= route.method %>, "<%= route.path %>", I<%= route.pascalCaseOperationId %>Request, I<%= route.pascalCaseOperationId %>Response, <%= route.pascalCaseOperationId %>RequestValidator>,
<% } %>
];

export class <%= pascalCaseEntityName %>AwsLambdaRouter extends AwsLambdaHttpRouter<<%= pascalCaseEntityName %>Routes> {
    private readonly routes: <%= pascalCaseEntityName %>Routes;

    public constructor(
        private readonly handler: <%= pascalCaseEntityName %>AwsLambdaRouterHandler
    ) {
        super();

        this.routes = [
            <% for(const route of routes) { %>
                {
                    path: "<%= route.path %>",
                    method: HttpMethod.<%= route.method %>,
                    handler: this.handler.handle<%= route.pascalCaseOperationId %>Request,
                    validator: new <%= route.pascalCaseOperationId %>RequestValidator(),
                },
            <% } %>
        ] as const;
    }

    public getRoutes(): <%= pascalCaseEntityName %>Routes {
        return this.routes;
    }
}