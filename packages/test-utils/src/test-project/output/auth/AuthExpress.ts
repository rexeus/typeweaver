/* eslint-disable */
/**
 * This file was automatically generated by typeweaver.
 * DO NOT EDIT. Instead, modify the source definition file and generate again.
 *
 * @generated by @rexeus/typeweaver
 */

import type { Request, Response, NextFunction } from "express";
import {
  TypeweaverExpress,
  type ExpressRequestHandler,
  type TypeweaverExpressOptions,
} from "../lib/express";

import type { IAccessTokenRequest } from "./AccessTokenRequest";
import { AccessTokenRequestValidator } from "./AccessTokenRequestValidator";
import type { AccessTokenResponse } from "./AccessTokenResponse";

import type { IRefreshTokenRequest } from "./RefreshTokenRequest";
import { RefreshTokenRequestValidator } from "./RefreshTokenRequestValidator";
import type { RefreshTokenResponse } from "./RefreshTokenResponse";

export type AuthExpressApiHandler = {
  readonly handleAccessTokenRequest: ExpressRequestHandler<
    IAccessTokenRequest,
    AccessTokenResponse
  >;

  readonly handleRefreshTokenRequest: ExpressRequestHandler<
    IRefreshTokenRequest,
    RefreshTokenResponse
  >;
};

export class AuthExpress extends TypeweaverExpress<AuthExpressApiHandler> {
  public constructor(options: TypeweaverExpressOptions<AuthExpressApiHandler>) {
    super(options);
  }

  protected override setupRoutes(): void {
    this.router.post(
      "/auth/access-token",
      async (req: Request, res: Response, next: NextFunction) =>
        this.handleRequest(
          req,
          res,
          next,
          new AccessTokenRequestValidator(),
          this.requestHandlers.handleAccessTokenRequest.bind(
            this.requestHandlers,
          ),
        ),
    );

    this.router.post(
      "/auth/refresh-token",
      async (req: Request, res: Response, next: NextFunction) =>
        this.handleRequest(
          req,
          res,
          next,
          new RefreshTokenRequestValidator(),
          this.requestHandlers.handleRefreshTokenRequest.bind(
            this.requestHandlers,
          ),
        ),
    );
  }
}
